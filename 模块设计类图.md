# 图书借阅推荐系统 - 模块设计类图

本文档包含系统6个核心功能模块的完整PlantUML类图代码，可直接在PlantUML网站或支持PlantUML的编辑器中渲染。

---

## 1. 用户管理模块类图

```plantuml
@startuml 用户管理模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.admin.user" {
    class UserAdminView {
        + freezeUserAccount()
        + unfreezeUserAccount()
        + queryUserAccount()
        + deleteViolationAccount()
    }
}

package "myapp.views.index.user" {
    class UserIndexView {
        + register()
        + login()
        + updateProfile()
        + logout()
    }
}

package "myapp.serializers" {
    class UserSerializer {
        + validate()
        + create()
        + update()
        + to_representation()
    }
}

package "myapp.models" {
    class User {
        - id: BigAutoField
        - username: CharField(100)
        - password: CharField(255)
        - email: CharField(100)
        - role: IntegerField
        - status: IntegerField
        - nickname: CharField(100)
        - avatar: CharField(255)
        - gender: IntegerField
        - mobile: CharField(20)
        - create_time: DateTimeField
        - last_login_time: DateTimeField
        - token: CharField(255)
        - score: IntegerField
        + save()
        + delete()
    }
    
    class LoginLog {
        - id: BigAutoField
        - user_id: ForeignKey
        - login_time: DateTimeField
        - ip_address: CharField(50)
        - device: CharField(100)
    }
}

package "myapp.auth" {
    class Token {
        + generate_token()
        + verify_token()
        + delete_token()
    }
}

UserAdminView ..> UserSerializer : use
UserIndexView ..> UserSerializer : use
UserSerializer ..> User : serialize
UserIndexView ..> Token : generate
UserIndexView ..> LoginLog : create
User "1" -- "0..*" LoginLog : logs

@enduml
```

---

## 2. 图书管理模块类图

```plantuml
@startuml 图书管理模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.admin.book" {
    class BookAdminView {
        + addBook()
        + editBook()
        + deleteBook()
        + updateStatus()
    }
}

package "myapp.views.index.book" {
    class BookIndexView {
        + listBooks()
        + detail()
        + search()
        + sort()
    }
}

package "myapp.serializers" {
    class BookSerializer {
        + validate()
        + create()
        + update()
        + to_representation()
    }
}

package "myapp.models" {
    class Book {
        - id: BigAutoField
        - title: CharField(200)
        - author: CharField(100)
        - translator: CharField(100)
        - isbn: CharField(20)
        - cover: CharField(255)
        - description: TextField
        - classification_id: ForeignKey
        - price: DecimalField
        - page_count: IntegerField
        - publish_date: DateField
        - publisher: CharField(100)
        - create_time: DateTimeField
        - pv: IntegerField
        - wish_count: IntegerField
        - collect_count: IntegerField
        - stock: IntegerField
        + save()
        + delete()
    }
    
    class Classification {
        - id: BigAutoField
        - title: CharField(100)
        - pid: IntegerField
        - create_time: DateTimeField
        + get_children()
        + get_parent()
    }
    
    class Tag {
        - id: BigAutoField
        - title: CharField(50)
        - create_time: DateTimeField
    }
    
    class Record {
        - id: BigAutoField
        - user_id: ForeignKey
        - book_id: ForeignKey
        - action_type: IntegerField
        - action_time: DateTimeField
    }
}

BookAdminView ..> BookSerializer : use
BookIndexView ..> BookSerializer : use
BookSerializer ..> Book : serialize
Book "n" -- "1" Classification : belongs to
Book "n" -- "n" Tag : tagged by
Book "1" -- "0..*" Record : records

@enduml
```

---

## 3. 借阅管理模块类图

```plantuml
@startuml 借阅管理模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.index.borrow" {
    class BorrowIndexView {
        + borrow()
        + returnBook()
        + renew()
        + listMine()
    }
}

package "myapp.views.admin.borrow" {
    class BorrowAdminView {
        + queryBorrowList()
        + updateBorrowStatus()
        + statistics()
    }
}

package "myapp.serializers" {
    class BorrowSerializer {
        + validate()
        + create()
        + update()
        + to_representation()
        + check_stock()
        + check_duplicate()
    }
}

package "myapp.models" {
    class Borrow {
        - id: BigAutoField
        - user_id: ForeignKey
        - book_id: ForeignKey
        - status: IntegerField
        - borrow_time: DateTimeField
        - expect_time: DateField
        - return_time: DateField
        - delayed: BooleanField
        - fine: DecimalField
        + is_overdue()
        + calculate_fine()
    }
    
    class BorrowLog {
        - id: BigAutoField
        - borrow_id: ForeignKey
        - operation: CharField(50)
        - operation_time: DateTimeField
        - operator_id: ForeignKey
        - remark: TextField
    }
    
    class Book {
        - id: BigAutoField
        - stock: IntegerField
        + decrease_stock()
        + increase_stock()
    }
    
    class User {
        - id: BigAutoField
        - username: CharField(100)
    }
}

BorrowIndexView ..> BorrowSerializer : use
BorrowAdminView ..> BorrowSerializer : use
BorrowSerializer ..> Borrow : serialize
BorrowSerializer ..> Book : update stock
Borrow "n" -- "1" User : borrowed by
Borrow "n" -- "1" Book : borrows
Borrow "1" -- "0..*" BorrowLog : logs

@enduml
```

---

## 4. 社区互动模块类图

```plantuml
@startuml 社区互动模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.index.comment" {
    class CommentView {
        + createComment()
        + listComment()
        + likeComment()
        + deleteComment()
    }
}

package "myapp.views.index.community" {
    class CommunityView {
        + createPost()
        + listPost()
        + likePost()
        + createPostComment()
    }
}

package "myapp.serializers" {
    class CommentSerializer {
        + validate()
        + create()
        + filter_sensitive_words()
        + to_representation()
    }
}

package "myapp.models" {
    class Comment {
        - id: BigAutoField
        - book_id: ForeignKey
        - user_id: ForeignKey
        - content: TextField
        - comment_time: DateTimeField
        - like_count: IntegerField
        - status: IntegerField
        + is_approved()
    }
    
    class CommunityPost {
        - id: BigAutoField
        - title: CharField(200)
        - content: TextField
        - author_id: ForeignKey
        - create_time: DateTimeField
        - like_count: IntegerField
        - comment_count: IntegerField
        - status: IntegerField
        - images: TextField
    }
    
    class CommunityComment {
        - id: BigAutoField
        - post_id: ForeignKey
        - user_id: ForeignKey
        - content: TextField
        - comment_time: DateTimeField
        - like_count: IntegerField
    }
    
    class ReadingEvent {
        - id: BigAutoField
        - title: CharField(200)
        - description: TextField
        - start_time: DateTimeField
        - end_time: DateTimeField
        - location: CharField(200)
        - max_participants: IntegerField
        - status: IntegerField
    }
    
    class User {
        - id: BigAutoField
        - username: CharField(100)
    }
    
    class Book {
        - id: BigAutoField
        - title: CharField(200)
    }
}

CommentView ..> CommentSerializer : use
CommunityView ..> CommentSerializer : use
CommentSerializer ..> Comment : serialize
CommentSerializer ..> CommunityPost : serialize
Comment "n" -- "1" User : posted by
Comment "n" -- "1" Book : comments on
CommunityPost "n" -- "1" User : authored by
CommunityPost "1" -- "0..*" CommunityComment : has
CommunityComment "n" -- "1" User : replied by

@enduml
```

---

## 5. 推荐算法模块类图

```plantuml
@startuml 推荐算法模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.index.book" {
    class RecommendApiView {
        + recommendList()
        + hotList()
    }
}

package "myapp.recommend_books.recommend" {
    class RecommendService {
        + buildRatingMatrix()
        + computeSimilarity()
        + recommendTopN()
        - findTopKSimilarUsers()
        - calculateCosineSimilarity()
        - filterUserBooks()
    }
    
    class RatingMatrix {
        - user_book_matrix: dict
        - user_ids: list
        - book_ids: list
        + add_rating()
        + get_user_vector()
        + get_book_vector()
        + normalize()
    }
}

package "myapp.models" {
    class Book {
        - id: BigAutoField
        - title: CharField(200)
        - pv: IntegerField
        - collect_count: IntegerField
        - wish_count: IntegerField
        + calculate_hot_score()
    }
    
    class Borrow {
        - id: BigAutoField
        - user_id: ForeignKey
        - book_id: ForeignKey
        - borrow_time: DateTimeField
    }
    
    class Record {
        - id: BigAutoField
        - user_id: ForeignKey
        - book_id: ForeignKey
        - action_type: IntegerField
        - action_time: DateTimeField
        + get_rating_weight()
    }
    
    class User {
        - id: BigAutoField
        - username: CharField(100)
    }
}

RecommendApiView ..> RecommendService : use
RecommendService ..> RatingMatrix : build
RecommendService ..> Borrow : read
RecommendService ..> Record : read
RatingMatrix ..> User : index by
RatingMatrix ..> Book : index by
Borrow "n" -- "1" User : borrowed by
Borrow "n" -- "1" Book : borrows
Record "n" -- "1" User : recorded by
Record "n" -- "1" Book : records

@enduml
```

---

## 6. 系统管理模块类图

```plantuml
@startuml 系统管理模块
!theme plain
skinparam classAttributeIconSize 0

package "myapp.views.admin.classification" {
    class ClassificationView {
        + addClassification()
        + editClassification()
        + deleteClassification()
        + listClassification()
    }
}

package "myapp.views.admin.tag" {
    class TagView {
        + addTag()
        + editTag()
        + deleteTag()
        + listTag()
    }
}

package "myapp.views.admin.notice" {
    class NoticeView {
        + publishNotice()
        + editNotice()
        + deleteNotice()
        + listNotice()
    }
}

package "myapp.views.admin" {
    class LogAdminView {
        + queryLoginLog()
        + queryOpLog()
        + queryErrorLog()
        + exportLog()
    }
}

package "myapp.models" {
    class Classification {
        - id: BigAutoField
        - title: CharField(100)
        - pid: IntegerField
        - create_time: DateTimeField
        + get_children()
        + get_parent()
        + is_root()
    }
    
    class Tag {
        - id: BigAutoField
        - title: CharField(50)
        - create_time: DateTimeField
        + get_book_count()
    }
    
    class Notice {
        - id: BigAutoField
        - title: CharField(200)
        - content: TextField
        - create_time: DateTimeField
        - expire_time: DateTimeField
        - status: IntegerField
        - priority: IntegerField
        + is_expired()
        + is_active()
    }
    
    class LoginLog {
        - id: BigAutoField
        - user_id: ForeignKey
        - login_time: DateTimeField
        - ip_address: CharField(50)
        - device: CharField(100)
        - status: IntegerField
    }
    
    class OpLog {
        - id: BigAutoField
        - user_id: ForeignKey
        - operation: CharField(100)
        - target: CharField(255)
        - detail: TextField
        - op_time: DateTimeField
        - ip_address: CharField(50)
    }
    
    class ErrorLog {
        - id: BigAutoField
        - user_id: ForeignKey
        - error_type: CharField(100)
        - error_message: TextField
        - stack_trace: TextField
        - request_url: CharField(255)
        - request_method: CharField(10)
        - error_time: DateTimeField
    }
    
    class User {
        - id: BigAutoField
        - username: CharField(100)
    }
}

ClassificationView ..> Classification : manage
TagView ..> Tag : manage
NoticeView ..> Notice : manage
LogAdminView ..> LoginLog : query
LogAdminView ..> OpLog : query
LogAdminView ..> ErrorLog : query
LoginLog "n" -- "1" User : logged by
OpLog "n" -- "1" User : operated by
ErrorLog "n" -- "1" User : caused by

@enduml
```

---

## 使用说明

### 在线渲染
1. 访问 [PlantUML在线编辑器](http://www.plantuml.com/plantuml/uml/)
2. 复制上述任意类图代码（包含 `@startuml` 到 `@enduml` 的完整代码）
3. 粘贴到编辑器中，即可查看渲染结果
4. 可以下载为PNG、SVG等格式

### 本地渲染
如果您使用支持PlantUML的编辑器（如VS Code + PlantUML扩展），可以直接在编辑器中预览这些图表。

### 主要类图关系说明

**关系符号**：
- `..>` : 依赖关系（虚线箭头）
- `--` : 关联关系（实线）
- `"n"` : 多重性（一对多、多对多等）

**包结构**：
- `myapp.views.admin.*` : 后台管理控制器
- `myapp.views.index.*` : 前台用户控制器
- `myapp.serializers` : DRF序列化器
- `myapp.models` : ORM数据模型
- `myapp.recommend_books.*` : 推荐算法服务

### 类图特点

1. **完整的类属性**：包含所有重要字段及其类型
2. **完整的类方法**：列出所有公共方法和关键私有方法
3. **清晰的依赖关系**：展示控制器、序列化器和模型之间的交互
4. **多重性标注**：明确1对多、多对多等数据库关系
5. **包结构清晰**：按照实际代码包路径组织类

### 自定义渲染主题

如需修改样式，可以在 `@startuml` 后添加主题设置：
```plantuml
!theme cerulean-outline
```

常用主题：`plain`, `cerulean`, `blueprint`, `mars`, `mimeograph`
