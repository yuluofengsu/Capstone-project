# 图书借阅推荐系统 - 类图设计

本文档包含系统6个核心功能模块的完整PlantUML类图代码。所有类图已移除package声明，设计更加简洁清晰。

---

## 1. 用户管理模块类图

```plantuml
@startuml 用户管理模块
!theme plain
skinparam classAttributeIconSize 0

class UserAdminView {
    + freezeUserAccount()
    + unfreezeUserAccount()
    + queryUserAccount()
    + deleteViolationAccount()
}

class UserIndexView {
    + register()
    + login()
    + updateProfile()
    + logout()
}

class UserSerializer {
    + validate()
    + create()
    + update()
    + to_representation()
}

class User {
    - id: BigAutoField
    - username: CharField
    - password: CharField
    - role: CharField
    - status: CharField
    - nickname: CharField
    - avatar: FileField
    - gender: CharField
    - mobile: CharField
    - email: CharField
    - description: TextField
    - create_time: DateTimeField
    - score: IntegerField
    - token: CharField
    - admin_token: CharField
}

class LoginLog {
    - id: BigAutoField
    - username: CharField
    - ip: CharField
    - ua: CharField
    - log_time: DateTimeField
}

UserAdminView ..> UserSerializer : uses
UserIndexView ..> UserSerializer : uses
UserSerializer ..> User : serializes
UserIndexView --> LoginLog : creates
User "1" -- "0..*" LoginLog : logs

@enduml
```

---

## 2. 图书管理模块类图

```plantuml
@startuml 图书管理模块
!theme plain
skinparam classAttributeIconSize 0

class BookAdminView {
    + list_api()
    + detail()
    + create()
    + update()
    + delete()
    + updateStatus()
}

class BookIndexView {
    + listBooks()
    + detail()
    + search()
    + sort()
}

class BookSerializer {
    + validate()
    + create()
    + update()
    + to_representation()
}

class UpdateBookSerializer {
    + update()
}

class Book {
    - id: BigAutoField
    - title: CharField
    - original_title: CharField
    - author: CharField
    - translator: CharField
    - isbn: CharField
    - press: CharField
    - pub_date: DateField
    - description: TextField
    - price: CharField
    - page_count: IntegerField
    - layout: CharField
    - cover: ImageField
    - status: CharField
    - repertory: IntegerField
    - score: CharField
    - pv: IntegerField
    - recommend_count: IntegerField
    - wish_count: IntegerField
    - collect_count: IntegerField
    - create_time: DateTimeField
    - classification: ForeignKey
    - tag: ManyToManyField
    - wish: ManyToManyField
    - collect: ManyToManyField
}

class Classification {
    - id: BigAutoField
    - title: CharField
    - pid: IntegerField
    - create_time: DateTimeField
    + get_children()
    + get_parent()
}

class Tag {
    - id: BigAutoField
    - title: CharField
    - create_time: DateTimeField
}

class Record {
    - id: BigAutoField
    - user: ForeignKey
    - book: ForeignKey
    - title: CharField
    - classification: ForeignKey
    - record_time: DateTimeField
}

BookAdminView ..> BookSerializer : uses
BookIndexView ..> BookSerializer : uses
BookSerializer ..> Book : serializes
Book "n" -- "1" Classification : belongs_to
Book "n" -- "n" Tag : tagged_by
Book "1" -- "0..*" Record : has_records

@enduml
```

---

## 3. 借阅管理模块类图

```plantuml
@startuml 借阅管理模块
!theme plain
skinparam classAttributeIconSize 0

class BorrowIndexView {
    + list_api()
    + create()
    + return_book()
    + renew()
}

class BorrowAdminView {
    + queryBorrowList()
    + updateBorrowStatus()
    + statistics()
}

class BorrowSerializer {
    + validate()
    + create()
    + update()
    + to_representation()
    + check_stock()
    + check_duplicate()
}

class Borrow {
    - id: BigAutoField
    - user: ForeignKey
    - book: ForeignKey
    - status: CharField
    - borrow_time: DateTimeField
    - expect_time: DateTimeField
    - return_time: DateTimeField
    - delayed: BooleanField
    + is_overdue()
    + calculate_fine()
}

class BorrowLog {
    - id: BigAutoField
    - user: ForeignKey
    - book: ForeignKey
    - action: CharField
    - log_time: DateTimeField
}

class Book {
    - id: BigAutoField
    - repertory: IntegerField
    + decrease_stock()
    + increase_stock()
}

class User {
    - id: BigAutoField
    - username: CharField
}

BorrowIndexView ..> BorrowSerializer : uses
BorrowAdminView ..> BorrowSerializer : uses
BorrowSerializer ..> Borrow : serializes
BorrowSerializer ..> Book : updates_stock
Borrow "n" -- "1" User : borrowed_by
Borrow "n" -- "1" Book : borrows
Borrow "1" -- "0..*" BorrowLog : logs

@enduml
```

---

## 4. 社区互动模块类图

```plantuml
@startuml 社区互动模块
!theme plain
skinparam classAttributeIconSize 0

class CommentView {
    + list_api()
    + list_my_comment()
    + create()
    + delete()
    + like()
}

class CommunityView {
    + post_list()
    + post_create()
    + post_detail()
    + post_delete()
    + post_like()
    + comment_create()
}

class CommentSerializer {
    + validate()
    + create()
    + to_representation()
}

class CommunityPostSerializer {
    + validate()
    + create()
    + to_representation()
}

class CommunityCommentSerializer {
    + validate()
    + create()
    + to_representation()
}

class Comment {
    - id: BigAutoField
    - content: CharField
    - user: ForeignKey
    - book: ForeignKey
    - comment_time: DateTimeField
    - like_count: IntegerField
}

class CommunityPost {
    - id: BigAutoField
    - title: CharField
    - content: TextField
    - user: ForeignKey
    - create_time: DateTimeField
    - views: IntegerField
    - like_count: IntegerField
    - liked_users: ManyToManyField
}

class CommunityComment {
    - id: BigAutoField
    - content: CharField
    - user: ForeignKey
    - post: ForeignKey
    - event: ForeignKey
    - create_time: DateTimeField
    - like_count: IntegerField
}

class ReadingEvent {
    - id: BigAutoField
    - title: CharField
    - description: TextField
    - cover: ImageField
    - start_time: DateTimeField
    - end_time: DateTimeField
    - create_time: DateTimeField
    - status: CharField
}

class User {
    - id: BigAutoField
    - username: CharField
}

class Book {
    - id: BigAutoField
    - title: CharField
}

CommentView ..> CommentSerializer : uses
CommunityView ..> CommunityPostSerializer : uses
CommunityView ..> CommunityCommentSerializer : uses
CommentSerializer ..> Comment : serializes
CommunityPostSerializer ..> CommunityPost : serializes
CommunityCommentSerializer ..> CommunityComment : serializes
Comment "n" -- "1" User : posted_by
Comment "n" -- "1" Book : comments_on
CommunityPost "n" -- "1" User : authored_by
CommunityPost "1" -- "0..*" CommunityComment : has
CommunityComment "n" -- "1" User : replied_by
CommunityComment "n" -- "1" ReadingEvent : comments_on

@enduml
```

---

## 5. 推荐算法模块类图

```plantuml
@startuml 推荐算法模块
!theme plain
skinparam classAttributeIconSize 0

class RecommendApiView {
    + recommend()
    + hot_list()
}

class RecommendService {
    + build_user_item_matrix()
    + recommend_books()
    + cosine_similarity()
    + find_similar_users()
    - filter_user_books()
}

class RatingMatrix {
    - matrix: ndarray
    - users: list
    - books: list
    + build()
    + get_user_vector()
    + normalize()
}

class Book {
    - id: BigAutoField
    - title: CharField
    - pv: IntegerField
    - collect_count: IntegerField
    - wish_count: IntegerField
    - collect: ManyToManyField
    - wish: ManyToManyField
    + calculate_hot_score()
}

class User {
    - id: BigAutoField
    - username: CharField
    - role: CharField
    - collect_books: ManyToManyField
    - wish_books: ManyToManyField
}

class Borrow {
    - id: BigAutoField
    - user: ForeignKey
    - book: ForeignKey
    - borrow_time: DateTimeField
}

class Record {
    - id: BigAutoField
    - user: ForeignKey
    - book: ForeignKey
    - record_time: DateTimeField
}

RecommendApiView ..> RecommendService : uses
RecommendService ..> RatingMatrix : builds
RecommendService ..> Book : recommends
RecommendService ..> User : filters_by
RatingMatrix --> User : indexes_by
RatingMatrix --> Book : indexes_by
Borrow "n" -- "1" User : borrowed_by
Borrow "n" -- "1" Book : borrows
Record "n" -- "1" User : recorded_by
Record "n" -- "1" Book : records

@enduml
```

---

## 6. 系统管理模块类图

```plantuml
@startuml 系统管理模块
!theme plain
skinparam classAttributeIconSize 0

class ClassificationView {
    + list_api()
    + create()
    + update()
    + delete()
}

class TagView {
    + list_api()
    + create()
    + update()
    + delete()
}

class NoticeView {
    + list_api()
    + create()
    + update()
    + delete()
}

class LogAdminView {
    + query_login_log()
    + query_op_log()
    + query_error_log()
    + export_log()
}

class Classification {
    - id: BigAutoField
    - title: CharField
    - pid: IntegerField
    - create_time: DateTimeField
    + get_children()
    + get_parent()
    + is_root()
}

class Tag {
    - id: BigAutoField
    - title: CharField
    - create_time: DateTimeField
}

class Notice {
    - id: BigAutoField
    - title: CharField
    - content: CharField
    - create_time: DateTimeField
}

class LoginLog {
    - id: BigAutoField
    - username: CharField
    - ip: CharField
    - ua: CharField
    - log_time: DateTimeField
}

class OpLog {
    - id: BigAutoField
    - re_ip: CharField
    - re_time: DateTimeField
    - re_url: CharField
    - re_method: CharField
    - re_content: CharField
    - access_time: CharField
}

class ErrorLog {
    - id: BigAutoField
    - ip: CharField
    - url: CharField
    - method: CharField
    - content: CharField
    - log_time: DateTimeField
}

class User {
    - id: BigAutoField
    - username: CharField
}

ClassificationView ..> Classification : manages
TagView ..> Tag : manages
NoticeView ..> Notice : manages
LogAdminView ..> LoginLog : queries
LogAdminView ..> OpLog : queries
LogAdminView ..> ErrorLog : queries

@enduml
```

---

## 使用说明

### 在线渲染
1. 访问 [PlantUML在线编辑器](http://www.plantuml.com/plantuml/uml/)
2. 复制上述任意类图代码（包含 `@startuml` 到 `@enduml` 的完整代码）
3. 粘贴到编辑器中，即可查看渲染结果
4. 可以下载为PNG、SVG等格式

### 本地渲染
如果您使用支持PlantUML的编辑器（如VS Code + PlantUML扩展），可以直接在编辑器中预览这些图表。

### 类图关系说明

**关系符号**：
- `..>` : 依赖关系（虚线箭头）
- `-->` : 创建关系（实线箭头）
- `--` : 关联关系（实线）
- `"n"` : 多重性（一对多、多对多等）
- `"0..*"` : 零到多重性

### 主要特点

1. **移除package声明**：所有类图已简化，移除复杂的包结构，使图表更加清晰易读
2. **完整的类属性**：包含所有重要字段及其类型
3. **完整的类方法**：列出所有公共方法和关键私有方法
4. **清晰的依赖关系**：展示控制器、序列化器和模型之间的交互
5. **多重性标注**：明确1对多、多对多等数据库关系

### 自定义主题

如需修改样式，可以在 `@startuml` 后添加主题设置：
```plantuml
!theme cerulean-outline
```

常用主题：`plain`, `cerulean`, `blueprint`, `mars`, `mimeograph`, `sketchy`
